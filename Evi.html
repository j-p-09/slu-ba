<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sledenje filmov</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1rem;
      background-color: #f9f9f9;
      color: #333;
    }

    h1 {
      text-align: center;
    }

    .search-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 1rem;
    }

    input[type="text"] {
      padding: 0.5rem;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      width: 80%;
      max-width: 300px;
    }

    .user-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .user-buttons button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }

    .user-info {
      text-align: center;
      margin-bottom: 1rem;
    }

    .user-id {
      font-size: 0.9rem;
      color: #777;
    }

    .stars-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-bottom: 1rem;
    }

    .star {
      font-size: 2rem;
      cursor: pointer;
      color: black;
    }

    .star.red {
      color: red;
    }

    .star.yellow {
      color: goldenrod;
    }

    .star.dot::after {
      content: '•';
      font-size: 1.5rem;
      color: black;
      margin-left: 5px;
    }

    .controls {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: white;
      padding: 0.5rem;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .controls button {
      font-size: 1.2rem;
      padding: 0.3rem 0.6rem;
      cursor: pointer;
    }

    @media (max-width: 600px) {
      .controls {
        flex-direction: row;
        justify-content: center;
        left: 0;
        right: 0;
      }
    }
  </style>
</head>
<body>

<h1>Sledenje Filmov</h1>

<div class="search-container">
  <input type="text" id="searchId" placeholder="Vnesi ID uporabnika (npr. 012)">
</div>

<div class="user-buttons">
  <button onclick="selectUser('012')">Anže</button>
  <button onclick="selectUser('013')">Tinkara</button>
</div>

<div class="user-info" id="userInfo"></div>
<div class="stars-container" id="starsContainer"></div>

<div class="controls">
  <button onclick="addStar()">+</button>
  <button onclick="removeStar()">-</button>
  <button onclick="addDot()">•</button>
  <button onclick="markUsed()">/</button>
  <button onclick="markPenalty()">~</button>
  <button onclick="showDots()">?</button>
</div>

<script>
  const users = {
    "012": { name: "Anže", id: "012" },
    "013": { name: "Tinkara", id: "013" },
  };

  let currentUserId = null;

  const searchInput = document.getElementById('searchId');
  const userInfo = document.getElementById('userInfo');
  const starsContainer = document.getElementById('starsContainer');

  searchInput.addEventListener('keyup', (e) => {
    if (e.key === 'Enter') {
      selectUser(searchInput.value);
    }
  });

  function selectUser(id) {
    if (!users[id]) {
      alert("Uporabnik ne obstaja.");
      return;
    }
    currentUserId = id;
    renderUser();
  }

  function renderUser() {
    const user = users[currentUserId];
    const data = getUserData();

    userInfo.innerHTML = `<h2>${user.name}</h2><div class="user-id">ID: ${user.id}</div>`;
    starsContainer.innerHTML = '';

    data.stars.forEach(star => {
      const span = document.createElement('span');
      span.classList.add('star');
      if (star === 'used') span.classList.add('red');
      else if (star === 'penalty') span.classList.add('yellow');
      else if (star === 'dot') span.classList.add('dot');
      span.textContent = '★';
      starsContainer.appendChild(span);
    });
  }

  function getUserData() {
    const saved = localStorage.getItem(`user_${currentUserId}`);
    if (saved) return JSON.parse(saved);
    const init = { stars: ["normal", "normal", "normal", "normal", "normal"], dots: 0 };
    localStorage.setItem(`user_${currentUserId}`, JSON.stringify(init));
    return init;
  }

  function saveUserData(data) {
    localStorage.setItem(`user_${currentUserId}`, JSON.stringify(data));
    renderUser();
  }

  function addStar() {
    if (!currentUserId) return;
    const data = getUserData();
    data.stars.push("normal");
    saveUserData(data);
  }

  function removeStar() {
    if (!currentUserId) return;
    const data = getUserData();
    data.stars.pop();
    saveUserData(data);
  }

  function addDot() {
    if (!currentUserId) return;
    const data = getUserData();
    data.stars.push("dot");
    saveUserData(data);
  }

  function markUsed() {
    if (!currentUserId) return;
    const data = getUserData();
    const i = data.stars.findIndex(s => s === "normal");
    if (i !== -1) data.stars[i] = "used";
    saveUserData(data);
  }

  function markPenalty() {
    if (!currentUserId) return;
    const data = getUserData();
    const i = data.stars.findIndex(s => s === "normal");
    if (i !== -1) data.stars[i] = "penalty";
    saveUserData(data);
  }

  function showDots() {
    let message = "Število črnih pik:\n";
    Object.keys(users).forEach(uid => {
      const data = localStorage.getItem(`user_${uid}`);
      if (data) {
        const parsed = JSON.parse(data);
        const count = parsed.stars.filter(s => s === "dot").length;
        message += `${users[uid].name}: ${count}\n`;
      }
    });
    alert(message);
  }
</script>

</body>
</html>